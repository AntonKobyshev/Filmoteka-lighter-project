{"mappings":"oeAAA,IAAAA,EAAAC,EAAA,S,gIAYA,MAAMC,GAAM,EAAAC,EAAAC,eAAcC,EAAAC,gBACpBC,GAAK,EAAAC,EAAAC,aAAYP,GACjBQ,GAAO,EAAAC,EAAAC,SAAQV,GAMrB,IAAI,EAAAW,EAAAC,SAJa,CACfC,MAAO,GACPC,QAAS,KAGX,MAAMC,EAAW,IAAI,EAAAjB,EAAAkB,aAEfC,EAAUC,SAASC,cAAc,SACjCC,EAAgBF,SAASC,cAAc,eACvCE,EAAcH,SAASC,cAAc,aACrCG,EAAYJ,SAASC,cAAc,4BACnCI,EAAeL,SAASC,cAAc,iBAQrC,SAASK,IACd,GAAIJ,EAAcK,UAAUC,SAAS,WAAY,OACjD,IAAIC,EAAiBC,EAAAC,WAAkB,SAEvC,EAAApB,EAAAqB,oBAAmBtB,GAAMuB,IACvB,GAAIA,EAAM,CACR,MAAMC,EAAc,SAASD,EAAKE,oBAElC,EAAA3B,EAAA4B,MAAI,EAAA5B,EAAA6B,KAAI9B,EAAI2B,IACTI,MAAKC,IACJ,GAAIA,EAASC,SAAU,CACrB,MAAMC,EAAMC,OAAOC,KAAKJ,EAASK,OAGjCC,aAAaC,QAAQ,YAAa,WAClCD,aAAaC,QAAQ,aAAcC,KAAKC,KAAKP,EAAIQ,OAAS,KAC1D,MAAMC,EAAaL,aAAaM,QAAQ,eACxC,EAAAC,EAAAC,kBAAiBH,GAGjBL,aAAaC,QAAQ,UAAWQ,KAAKC,UAAUhB,EAASK,QAEnDnB,EAAaE,UAAUC,SAAS,oBACnCH,EAAaE,UAAU6B,IAAI,mBAE7BC,EAAkBhB,EAAKI,aAAaM,QAAQ,e,MAIxC1B,EAAaE,UAAUC,SAAS,oBAClCH,EAAaE,UAAU+B,OAAO,mBAEhClC,EAAUmC,UAAY,GACtBC,QAAQC,IAAI,oB,IAGfC,OAAMC,IACLH,QAAQG,MAAMA,EAAM,G,KAI5BjC,EAAAkC,aAAoBnC,GACpBP,EAAcK,UAAU6B,IAAI,aAC5BjC,EAAYI,UAAU+B,OAAO,Y,CAmDhBO,eAAAR,EAAiChB,EAAKyB,EAAO,GAC1D,IACE,IAAIrC,EAAiBC,EAAAC,WAAkB,QAEvC6B,QAAQC,IAAI,cAMZ,MAAMM,EAA0B,IAAZD,EAAO,GACrBE,EAAkB,GAAPF,EAEXG,EADc5B,EAAI6B,MAAMH,EAAYC,GACdG,KAAIN,MAAMO,IACpCvD,EAASuD,GAAKA,QACDvD,EAASwD,oBAElBC,QAAcC,QAAQC,IAAIP,IAChC,EAAAQ,EAAA/D,SAAkB4D,GAClBd,QAAQC,IAAI,eACZ/B,EAAAkC,aAAoBnC,E,CACpB,MAAOkC,GACPH,QAAQC,IAAIE,E,EA1HhBxC,EAAYuD,iBAAiB,SAoDtB,WACL,GAAIvD,EAAYI,UAAUC,SAAS,aAAc,OACjDL,EAAYI,UAAU6B,IAAI,aAC1BlC,EAAcK,UAAU+B,OAAO,aAE/B,IAAI7B,EAAiBC,EAAAC,WAAkB,SAEvC,EAAApB,EAAAqB,oBAAmBtB,GAAMuB,IACvB,GAAIA,EAAM,CACR,MAAMC,EAAc,SAASD,EAAKE,kBAElC,EAAA3B,EAAA4B,MAAI,EAAA5B,EAAA6B,KAAI9B,EAAI2B,IACTI,MAAKC,IACJ,GAAIA,EAASC,SAAU,CACrB,MAAMC,EAAMC,OAAOC,KAAKJ,EAASK,OAGjCC,aAAaC,QAAQ,YAAa,SAClCD,aAAaC,QAAQ,aAAcC,KAAKC,KAAKP,EAAIQ,OAAS,KAC1D,MAAMC,EAAaL,aAAaM,QAAQ,eACxC,EAAAC,EAAAC,kBAAiBH,GAGjBL,aAAaC,QAAQ,SAAUQ,KAAKC,UAAUhB,EAASK,QAElDnB,EAAaE,UAAUC,SAAS,oBACnCH,EAAaE,UAAU6B,IAAI,mBAE7BC,EAAkBhB,E,MAIdhB,EAAaE,UAAUC,SAAS,oBAClCH,EAAaE,UAAU+B,OAAO,mBAEhClC,EAAUmC,UAAY,GAEtBC,QAAQC,IAAI,oB,IAGfC,OAAMC,IACLH,QAAQG,MAAMA,EAAM,G,KAI5BjC,EAAAkC,aAAoBnC,E,IAhGtBP,EAAcwD,iBAAiB,QAASpD,GACxCP,EAAQ2D,iBAAiB,QAASC,EAAAC,iBAElCtD","sources":["src/js/libRender.js"],"sourcesContent":["import { API_service } from './api/apiService';\nimport { getDatabase, ref, get } from 'firebase/database';\nimport { getAuth, onAuthStateChanged } from 'firebase/auth';\nimport { initializeApp } from 'firebase/app';\nimport { firebaseConfig } from './api/firebase/firebaseConfig';\nimport renderFilmsMarkup from './librender/renderFilmsMarkup';\nimport dataStorage from './api/firebase/data-storage';\nimport { onOpenModalAuth } from './api/firebase/auth-settings';\nimport * as spiner from './features/auth/spiner';\nimport { renderPagination } from './pagination';\nimport { Loading } from 'notiflix';\n\nconst app = initializeApp(firebaseConfig);\nconst db = getDatabase(app);\nconst auth = getAuth(app);\n\nconst userData = {\n  queue: {},\n  watched: {},\n};\nnew dataStorage(userData);\nconst filmsApi = new API_service();\n\nconst authBtn = document.querySelector('#auth');\nconst watchedBtnRef = document.querySelector('.js-watched');\nconst queueBtnRef = document.querySelector('.js-queue');\nconst filmsList = document.querySelector('.library__container-list');\nconst emptyMessage = document.querySelector('.library__mes');\n\nqueueBtnRef.addEventListener('click', onQueueBtnClick);\nwatchedBtnRef.addEventListener('click', onWatchedBtnClick);\nauthBtn.addEventListener('click', onOpenModalAuth);\n\nonWatchedBtnClick();\n\nexport function onWatchedBtnClick() {\n  if (watchedBtnRef.classList.contains('current')) return;\n  let spinerSelector = spiner.spinerInit('body');\n\n  onAuthStateChanged(auth, user => {\n    if (user) {\n      const libDataBase = `users/${user.uid}/lib/watched/`;\n\n      get(ref(db, libDataBase))\n        .then(snapshot => {\n          if (snapshot.exists()) {\n            const ids = Object.keys(snapshot.val());\n\n            //pagination\n            localStorage.setItem('fetchType', 'watched');\n            localStorage.setItem('totalPages', Math.ceil(ids.length / 20));\n            const totalPages = localStorage.getItem('totalPages');\n            renderPagination(totalPages);\n            //pagination\n\n            localStorage.setItem('watched', JSON.stringify(snapshot.val()));\n\n            if (!emptyMessage.classList.contains('visually-hidden')) {\n              emptyMessage.classList.add('visually-hidden');\n            }\n            renderMarkupByIds(ids, localStorage.getItem('currentPage'));\n\n            //Render\n          } else {\n            if (emptyMessage.classList.contains('visually-hidden')) {\n              emptyMessage.classList.remove('visually-hidden');\n            }\n            filmsList.innerHTML = '';\n            console.log('No data available');\n          }\n        })\n        .catch(error => {\n          console.error(error);\n        });\n    }\n  });\n  spiner.removeSpiner(spinerSelector);\n  watchedBtnRef.classList.add('is-active');\n  queueBtnRef.classList.remove('is-active');\n}\n\nexport function onQueueBtnClick() {\n  if (queueBtnRef.classList.contains('is-active')) return;\n  queueBtnRef.classList.add('is-active');\n  watchedBtnRef.classList.remove('is-active');\n\n  let spinerSelector = spiner.spinerInit('body');\n\n  onAuthStateChanged(auth, user => {\n    if (user) {\n      const libDataBase = `users/${user.uid}/lib/queue/`;\n\n      get(ref(db, libDataBase))\n        .then(snapshot => {\n          if (snapshot.exists()) {\n            const ids = Object.keys(snapshot.val());\n\n            //pagination\n            localStorage.setItem('fetchType', 'queue');\n            localStorage.setItem('totalPages', Math.ceil(ids.length / 20));\n            const totalPages = localStorage.getItem('totalPages');\n            renderPagination(totalPages);\n            //pagination\n\n            localStorage.setItem('queued', JSON.stringify(snapshot.val()));\n\n            if (!emptyMessage.classList.contains('visually-hidden')) {\n              emptyMessage.classList.add('visually-hidden');\n            }\n            renderMarkupByIds(ids);\n\n            //render\n          } else {\n            if (emptyMessage.classList.contains('visually-hidden')) {\n              emptyMessage.classList.remove('visually-hidden');\n            }\n            filmsList.innerHTML = '';\n\n            console.log('No data available');\n          }\n        })\n        .catch(error => {\n          console.error(error);\n        });\n    }\n  });\n  spiner.removeSpiner(spinerSelector);\n}\n\nexport default async function renderMarkupByIds(ids, page = 1) {\n  try {\n    let spinerSelector = spiner.spinerInit('body');\n\n    console.log('spinner on');\n\n    // Loading.pulse({\n    //   svgColor: 'orange',\n    // });\n\n    const startIndex = (page - 1) * 20;\n    const endIndex = page * 20;\n    const idsToRender = ids.slice(startIndex, endIndex);\n    const arrProm = idsToRender.map(async id => {\n      filmsApi.id = id;\n      return await filmsApi.fetchMovieById();\n    });\n    const films = await Promise.all(arrProm);\n    renderFilmsMarkup(films);\n    console.log('spinner off');\n    spiner.removeSpiner(spinerSelector);\n  } catch (error) {\n    console.log(error);\n  }\n}\n"],"names":["$lOKsE","parcelRequire","$54329e98fd9848c5$var$app","$gKkQl","initializeApp","$fEVjq","firebaseConfig","$54329e98fd9848c5$var$db","$jAzyG","getDatabase","$54329e98fd9848c5$var$auth","$eyjy7","getAuth","$2tZq5","default","queue","watched","$54329e98fd9848c5$var$filmsApi","API_service","$54329e98fd9848c5$var$authBtn","document","querySelector","$54329e98fd9848c5$var$watchedBtnRef","$54329e98fd9848c5$var$queueBtnRef","$54329e98fd9848c5$var$filmsList","$54329e98fd9848c5$var$emptyMessage","$54329e98fd9848c5$export$852eb21c65e590aa","classList","contains","spinerSelector","$bITeO","spinerInit","onAuthStateChanged","user","libDataBase","uid","get","ref","then","snapshot","exists","ids","Object","keys","val","localStorage","setItem","Math","ceil","length","totalPages","getItem","$2nhTy","renderPagination","JSON","stringify","add","$54329e98fd9848c5$export$2e2bcd8739ae039","remove","innerHTML","console","log","catch","error","removeSpiner","async","page","startIndex","endIndex","arrProm","slice","map","id","fetchMovieById","films","Promise","all","$a14sY","addEventListener","$e4m3s","onOpenModalAuth"],"version":3,"file":"library.0aa03efb.js.map"}