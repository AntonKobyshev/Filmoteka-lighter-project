{"mappings":"qhBAAA,I,EAAAA,EAAAC,EAAA,S,oDCEe,SAAAC,EAAyBC,GACtC,OAAOA,EACJC,KACC,EAACC,YACCA,EAAWC,MACXA,EACAC,KAAAC,EAAIC,aACJA,EAAYC,eACZA,EAAcC,UACdA,EAASC,OACTA,EAAMC,aACNA,EACAC,GAAAC,MAEA,IAAIC,EAWJ,OAVIJ,IACFI,EAAaJ,EAAOR,KAAI,EAACG,KAAEA,KAAWA,IAAMU,KAAK,OAE/CN,IACFK,EAAaE,EAAAC,GACVC,QAAO,EAACN,GAAEA,KAASH,EAAUU,SAASP,KACtCV,KAAI,EAACG,KAAEA,KAAWA,IAClBU,KAAK,OAGH,mCAAmCF,6GAEYV,UACpDC,GAASE,mIAIyBF,GAASE,oGAENQ,GAAc,6DACfP,GAAgBC,GAAkB,QAAQY,MAClE,EACA,2DAE4BT,GAAgB,iFAGhD,IAGbI,KAAK,G,CC/CVE,EAAiBI,KAAKC,MAAM,4hBCE5B,MAAMC,EAAeC,SAASC,cAAc,4BAE7B,SAAAC,EAA2BzB,GACxCsB,EAAaI,UAAY3B,EAAgBC,E,kBHG3C,MAAM2B,GAAM,EAAAC,EAAAC,eAAcC,EAAAC,gBACpBC,GAAK,EAAAC,EAAAC,aAAYP,GACjBQ,GAAO,EAAAC,EAAAC,SAAQV,GAMrB,IAAI,EAAAW,EAAAC,SAJa,CACfC,MAAO,GACPC,QAAS,KAGX,MAAMC,EAAW,IAAI,EAAA7C,EAAA8C,aAGfC,EAAgBrB,SAASC,cAAc,eACvCqB,EAActB,SAASC,cAAc,aACrCsB,EAAYvB,SAASC,cAAc,4BA+D1BuB,eAAAC,EAAiCC,GAC9C,IACE,MAAMC,EAAUD,EAAIhD,KAAI8C,MAAMpC,IAC5B+B,EAAS/B,GAAKA,QACD+B,EAASS,oBAGxB1B,QADoB2B,QAAQC,IAAIH,G,CAEhC,MAAOI,GACPC,QAAQC,IAAIF,E,EAtEhBT,EAAYY,iBAAiB,SAgC7B,WACE,GAAIZ,EAAYa,UAAUC,SAAS,aAAc,OACjDd,EAAYa,UAAUE,IAAI,aAC1BhB,EAAcc,UAAUG,OAAO,cAE/B,EAAAzB,EAAA0B,oBAAmB3B,GAAM4B,IACvB,GAAIA,EAAM,CACR,MAAMC,EAAc,SAASD,EAAKE,kBAElC,EAAAhC,EAAAiC,MAAI,EAAAjC,EAAAkC,KAAInC,EAAIgC,IACTI,MAAKC,IACJ,GAAIA,EAASC,SAAU,CAGnBtB,EADYuB,OAAOC,KAAKH,EAASI,O,MAInC3B,EAAUpB,UAAY,GACtBgD,iBACAnB,QAAQC,IAAI,oB,IAGfmB,OAAMrB,IACLC,QAAQD,MAAMA,EAAM,G,QAtD9BV,EAAca,iBAAiB,SAE/B,WACE,GAAIb,EAAcc,UAAUC,SAAS,WAAY,QAEjD,EAAAvB,EAAA0B,oBAAmB3B,GAAM4B,IACvB,GAAIA,EAAM,CACR,MAAMC,EAAc,SAASD,EAAKE,oBAElC,EAAAhC,EAAAiC,MAAI,EAAAjC,EAAAkC,KAAInC,EAAIgC,IACTI,MAAKC,IACJ,GAAIA,EAASC,SAAU,CAGnBtB,EADUuB,OAAOC,KAAKH,EAASI,O,MAIjC3B,EAAUpB,UAAY,GACtB6B,QAAQC,IAAI,oB,IAGfmB,OAAMrB,IACLC,QAAQD,MAAMA,EAAM,G,KAK5BV,EAAcc,UAAUE,IAAI,aAC5Bf,EAAYa,UAAUG,OAAO,Y","sources":["src/js/libRender.js","src/js/templates/filmsListMarkupTempl.js","src/js/genres.json","src/js/templates/renderFilmsMarkup.js"],"sourcesContent":["import { API_service } from './api/apiService';\nimport { getDatabase, ref, get } from 'firebase/database';\nimport { getAuth, onAuthStateChanged } from 'firebase/auth';\nimport { initializeApp } from 'firebase/app';\nimport { firebaseConfig } from './api/firebase/firebaseConfig';\nimport renderFilmsMarkup from './templates/renderFilmsMarkup';\nimport dataStorage from './api/firebase/data-storage';\n\nconst app = initializeApp(firebaseConfig);\nconst db = getDatabase(app);\nconst auth = getAuth(app);\n\nconst userData = {\n  queue: {},\n  watched: {},\n};\nnew dataStorage(userData);\nconst filmsApi = new API_service();\n\n\nconst watchedBtnRef = document.querySelector('.js-watched');\nconst queueBtnRef = document.querySelector('.js-queue');\nconst filmsList = document.querySelector('.library__container-list');\n\nqueueBtnRef.addEventListener('click', onQueueBtnClick);\nwatchedBtnRef.addEventListener('click', onWatchedBtnClick);\n\nfunction onWatchedBtnClick() {\n  if (watchedBtnRef.classList.contains('current')) return;\n\n  onAuthStateChanged(auth, user => {\n    if (user) {\n      const libDataBase = `users/${user.uid}/lib/watched/`;\n\n      get(ref(db, libDataBase))\n        .then(snapshot => {\n          if (snapshot.exists()) {\n            \n            const ids = Object.keys(snapshot.val());\n              renderMarkupByIds(ids);\n           //Render\n          } else {\n            filmsList.innerHTML = '';\n            console.log('No data available');\n          }\n        })\n        .catch(error => {\n          console.error(error);\n        });\n    }\n  });\n\n  watchedBtnRef.classList.add('is-active');\n  queueBtnRef.classList.remove('is-active');\n}\n\nfunction onQueueBtnClick() {\n  if (queueBtnRef.classList.contains('is-active')) return;\n  queueBtnRef.classList.add('is-active');\n  watchedBtnRef.classList.remove('is-active');\n\n  onAuthStateChanged(auth, user => {\n    if (user) {\n      const libDataBase = `users/${user.uid}/lib/queue/`;\n\n      get(ref(db, libDataBase))\n        .then(snapshot => {\n          if (snapshot.exists()) {\n          \n              const ids = Object.keys(snapshot.val());\n              renderMarkupByIds(ids);\n           //render\n          } else {\n            filmsList.innerHTML = '';\n            addErrorStyles();\n            console.log('No data available');\n          }\n        })\n        .catch(error => {\n          console.error(error);\n        });\n    }\n  });\n}\n\nexport default async function renderMarkupByIds(ids) {\n  try {\n    const arrProm = ids.map(async id => {\n      filmsApi.id = id;\n      return await filmsApi.fetchMovieById();\n    });\n    const films = await Promise.all(arrProm);\n    renderFilmsMarkup(films);\n  } catch (error) {\n    console.log(error);\n  }\n}","import genresData from '../genres.json';\n\nexport default function makeFilmsMarkup(films) {\n  return films\n    .map(\n      ({\n        poster_path,\n        title,\n        name,\n        release_date,\n        first_air_date,\n        genre_ids,\n        genres,\n        vote_average,\n        id,\n      }) => {\n        let filmGenres;\n        if (genres) {\n          filmGenres = genres.map(({ name }) => name).join(', ');\n        }\n        if (genre_ids) {\n          filmGenres = genresData\n            .filter(({ id }) => genre_ids.includes(id))\n            .map(({ name }) => name)\n            .join(', ');\n        }\n\n        return `<li class=\"films__item\" data-id=${id}>\n                <div class=\"films__img\">\n                <img src=https://image.tmdb.org/t/p/original${poster_path} alt=\"${\n          title || name\n        }\" loading=\"lazy\">\n        </div>\n                <div class=\"films__description\">\n                  <p class=\"films__title\">${title || name}</p>\n                  <div class=\"films__meta\">\n                    <p class=\"films__genres\">${filmGenres || 'Action'}</p>\n                    <p class=\"films__data\">${(release_date || first_air_date || '2023').slice(\n                      0,\n                      4,\n                    )}</p>\n                    <span class=\"films__rating\">${vote_average || '-'}</span>\n                  </div>\n                </div>\n            </li>`;\n      },\n    )\n    .join('');\n}\n","[\n    {\n        \"id\": 28,\n        \"name\": \"Action\"\n    },\n    {\n        \"id\": 12,\n        \"name\": \"Adventure\"\n    },\n    {\n        \"id\": 16,\n        \"name\": \"Animation\"\n    },\n    {\n        \"id\": 35,\n        \"name\": \"Comedy\"\n    },\n    {\n        \"id\": 80,\n        \"name\": \"Crime\"\n    },\n    {\n        \"id\": 99,\n        \"name\": \"Documentary\"\n    },\n    {\n        \"id\": 18,\n        \"name\": \"Drama\"\n    },\n    {\n        \"id\": 10751,\n        \"name\": \"Family\"\n    },\n    {\n        \"id\": 14,\n        \"name\": \"Fantasy\"\n    },\n    {\n        \"id\": 36,\n        \"name\": \"History\"\n    },\n    {\n        \"id\": 27,\n        \"name\": \"Horror\"\n    },\n    {\n        \"id\": 10402,\n        \"name\": \"Music\"\n    },\n    {\n        \"id\": 9648,\n        \"name\": \"Mystery\"\n    },\n    {\n        \"id\": 10749,\n        \"name\": \"Romance\"\n    },\n    {\n        \"id\": 878,\n        \"name\": \"Science Fiction\"\n    },\n    {\n        \"id\": 10770,\n        \"name\": \"TV Movie\"\n    },\n    {\n        \"id\": 53,\n        \"name\": \"Thriller\"\n    },\n    {\n        \"id\": 10752,\n        \"name\": \"War\"\n    },\n    {\n        \"id\": 37,\n        \"name\": \"Western\"\n    }\n]","import makeFilmsMarkup from './filmsListMarkupTempl';\n\nconst filmsListRef = document.querySelector('.library__container-list');\n\nexport default function renderFilmsMarkup(films) {\n  filmsListRef.innerHTML = makeFilmsMarkup(films);\n}\n"],"names":["$lOKsE","parcelRequire","$42b37e5713bc4789$export$2e2bcd8739ae039","films","map","poster_path","title","name","name1","release_date","first_air_date","genre_ids","genres","vote_average","id","id1","filmGenres","join","$parcel$interopDefault","$1a18d98a372d8e28$exports","filter","includes","slice","JSON","parse","$6be83146fa16947e$var$filmsListRef","document","querySelector","$6be83146fa16947e$export$2e2bcd8739ae039","innerHTML","$54329e98fd9848c5$var$app","$gKkQl","initializeApp","$fEVjq","firebaseConfig","$54329e98fd9848c5$var$db","$jAzyG","getDatabase","$54329e98fd9848c5$var$auth","$eyjy7","getAuth","$2tZq5","default","queue","watched","$54329e98fd9848c5$var$filmsApi","API_service","$54329e98fd9848c5$var$watchedBtnRef","$54329e98fd9848c5$var$queueBtnRef","$54329e98fd9848c5$var$filmsList","async","$54329e98fd9848c5$export$2e2bcd8739ae039","ids","arrProm","fetchMovieById","Promise","all","error","console","log","addEventListener","classList","contains","add","remove","onAuthStateChanged","user","libDataBase","uid","get","ref","then","snapshot","exists","Object","keys","val","addErrorStyles","catch"],"version":3,"file":"library.f5df759b.js.map"}